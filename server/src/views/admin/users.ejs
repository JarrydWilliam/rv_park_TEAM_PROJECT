<!doctype html>
<html lang="en">
  <head>
    <%- include('../partials/head', { title: 'User Management' }) %>
  </head>
  <body>
    <%- include('../partials/nav') %>

    <main class="container py-4">

      <h1 class="h3 mb-3">User Management</h1>

      <!-- Success Message -->
      <% if (typeof message !== 'undefined' && message) { %>
        <div class="alert alert-success"><%= message %></div>
      <% } %>

      <!-- Error Message -->
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger"><%= error %></div>
      <% } %>

      <div class="table-responsive mt-4">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Username</th>
              <th>Role</th>
              <th>DoD Affiliation</th>
              <th>Branch</th>
              <th>Rank</th>
              <th>Adults</th>
              <th>Pets</th>
                      <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <% if (!users || users.length === 0) { %>
              <tr>
                <td colspan="10" class="text-center text-muted py-4">
                  No users found.
                </td>
              </tr>
            <% } else { %>
              <% users.forEach(u => { %>
                <tr>
                  <td><%= u.id %></td>
                  <td><%= u.first_name %> <%= u.last_name %></td>
                  <td><%= u.email %></td>
                  <td><%= u.username %></td>
                  <td><%= u.role %></td>
                  <td><%= u.dod_affiliation %></td>
                  <td><%= u.branch %></td>
                  <td><%= u.rank_grade %></td>
                  <td><%= u.num_adults %></td>
                  <td><%= u.num_pets %></td>
                            <td>
                              <form method="post" action="/admin/users/<%= u.id %>/role" class="d-inline">
                                <select name="role" class="form-select form-select-sm d-inline w-auto" style="display:inline-block;vertical-align:middle;">
                                  <option value="customer" <%= u.role === 'customer' ? 'selected' : '' %>>Customer</option>
                                  <option value="employee" <%= u.role === 'employee' ? 'selected' : '' %>>Employee</option>
                                  <option value="admin" <%= u.role === 'admin' ? 'selected' : '' %>>Admin</option>
                                </select>
                                <button type="submit" class="btn btn-sm btn-outline-primary ms-1">Update</button>
                              </form>
                            </td>
                </tr>
              <% }) %>
            <% } %>
          </tbody>
        </table>
      </div>

    </main>

    <%- include('../partials/footer') %>
  </body>
</html>
