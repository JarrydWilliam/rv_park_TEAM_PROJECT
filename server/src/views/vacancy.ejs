<!doctype html>
<html lang="en">
  <head>
    <%- include('partials/head') %>
  </head>
  <body>
    <%- include('partials/nav') %>

    <header class="page-hero">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <p class="text-uppercase text-success fw-semibold small mb-1">
              Park overview
            </p>
            <h1 class="display-6 mb-2">Vacancy board</h1>
            <p class="lead mb-0 text-muted">
              Quick snapshot of which sites are currently occupied or available.
            </p>
          </div>
        </div>
      </div>
    </header>

    <main class="container py-4">
      <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger d-flex align-items-center" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div><%= error %></div>
        </div>
      <% } %>

      <%
        const items =
          (typeof sites !== 'undefined' && sites) ||
          (typeof results !== 'undefined' && results) ||
          (typeof rows !== 'undefined' && rows) ||
          [];
      %>

      <% if (!items || items.length === 0) { %>
        <div class="card shadow-sm">
          <div class="card-body">
            <p class="mb-0 text-muted">
              No vacancy data is available right now. Try again later or check the Reservations view.
            </p>
          </div>
        </div>
      <% } else { %>
        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="h5 mb-3">Sites</h2>
            <div class="table-responsive">
              <table class="table align-middle mb-0">
                <thead>
                  <tr>
                    <th scope="col">Site</th>
                    <th scope="col">Type</th>
                    <th scope="col">Status</th>
                    <th scope="col">Max length</th>
                  </tr>
                </thead>
                <tbody>
                  <% items.forEach(function (site) { %>
                    <tr>
                      <td>
                        <%= (site && (site.code || site.siteCode || site.site_code || site.id || site.siteId || site.site_id)) || '' %>
                      </td>
                      <td>
                        <%= (site && (site.type || site.siteType || site.site_type)) || '' %>
                      </td>
                      <td>
                        <%
                          const statusRaw =
                            site &&
                            (site.status ||
                              (site.isOccupied === true ? 'Occupied'
                                : site.isOccupied === false ? 'Available'
                                : null));
                          const status = statusRaw || 'Unknown';
                          const isOccupied = status.toLowerCase() === 'occupied';
                        %>
                        <span class="badge <%= isOccupied ? 'bg-danger-subtle text-danger-emphasis' : 'bg-success-subtle text-success-emphasis' %>">
                          <%= status %>
                        </span>
                      </td>
                      <td>
                        <%= (site && (site.maxLength || site.max_length || site.rigLength || site.rig_length)) || 'â€”' %>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      <% } %>
    </main>

    <%- include('partials/footer') %>
  </body>
</html>
